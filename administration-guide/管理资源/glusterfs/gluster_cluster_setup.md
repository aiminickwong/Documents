# 设置 gluster 集群

要使用 glusterfs 作为存储域，首先需要设置好一个 glusterfs 的集群。

要在 EayunOS 下设置一个集群为 gluster 集群，请按照如下步骤执行：

**添加一个Gluster存储节点**

* 进入 EayunOS 管理平台。
* 切换至**集群**选项卡。
* 选择一个像要设置成 gluster 集群的集群。
* 点击**编辑**按钮。
* 在弹出窗口中，勾选**启用 Gluster 服务**：

  ![](../../images/gluster_cluster_setting.png)

* 向该集群内添加 EayunOS 宿主机，设置集群为 gluster 集群之后，向该集群添加的每一台宿主机都可以成为该 gluster 集群下的一个 gluster 节点。

  > **重要**
  >
  > EayunOS 宿主机的 IP 防火墙服务默认是开启的。如果您要使用防火墙的功能，并且同时要让 gluster 集群能正常建立并工作，请确认以下步骤：
  >
  > * 如果你是通过管理平台界面添加的宿主机，请确认在添加宿主机的弹出窗口中的**高级参数**中勾选了**自动配置的主机防火墙**。
  > * 如果你是通过点击**批准**按钮添加的宿主机，在您批准过后宿主机可能会变成 **Non operational** 状态，这是因为通过**批准**按钮添加宿主机的过程中，宿主机的防火墙没有设置正确。暂时的解决办法是：
  >   * 将该宿主机置于**维护**模式。
  >   * 选中该宿主机，然后点击**重新安装**按钮。
  >   * 在弹出的窗口中，确认**自动配置的主机防火墙**勾选框被选中。
  >   * 点击**确定**，等待宿主机变成 **Up** 状态。

* 如果在设置集群为 gluster 集群之前，该集群已经有 EayunOS 宿主机，请按照如下步骤对每台之前已经加入集群的宿主机进行配置：

  * 进入**主机**选项卡。
  * 选择已有的 EayunOS 宿主机。
  * 点击**维护**按钮，如果主机有正在运行的虚拟机，维护的过程需要等待一段时间，因为虚拟机需要迁移至其它主机。
  * 待主机进入维护状态之后，点击**重新安装**
  * 在弹出的窗口中，设置好验证方式，然后点击**确定**。
  * 等待该主机变成 **Up** 状态。
