# 设置 gluster 卷

EayunOS 的 gluster 存储域是基于 gluster 卷（volume）的，所以接下来需要在 gluster 集群下设置 gluster 卷：

* 进入 EayunOS 管理平台。
* 切换到**卷**标签。
* 点击**新建**按钮。
* 在弹出的设置对话框中，在**名称**一栏填入 gluster 卷的名称，该名称将用于后面添加 gluster 存储域所使用。
* 在**类型**下拉框中，请根据你的实际情况，参考下面的说明来决定使用哪种 gluster 卷的类型，同时你也可以参考 glusterfs 的[官方文档](http://gluster.readthedocs.org/en/latest/Administrator%20Guide/Setting%20Up%20Volumes/)

  * **Distribute**：在该种模式下，一份数据（如一个文件）将会以份为单位存储在 gluster 卷下的某一个 brick 中，并且不会有备份。如果数据不重要，或者你在其它层面上能保证数据不会丢失（如设置了冗余），且想最大化利用现有物理存储空间，可以使用该种模式。
  * **Replicate**：在该种模式下，一份数据（如一个文件）将会以份为单位存储在 gluster 卷的所有 brick 中，从而实现数据的冗余。如果你的数据很重要，现有物理存储空间不是问题，且没有其它的存储备份机制，建议选择此种模式。
  * **Strip**：在该种模式下，一份数据（如一个文件）将会分成碎片，然后以碎片为单位存储在 gluster 卷的所有 brick 中，并且不会有备份。如果数据不重要，或者你在其它层面上能保证数据不会丢失，并且文件有高并发访问的需求，又想最大化利用现有物理存储空间，建议使用该种模式。
  * **Distributed Strip**：在该种模式下，一份数据（如一个文件）将会分成碎片，然后以碎片为单位存储在 gluster 卷中的某一组 brick（Strip 组）中的所有 brick 中，且没有备份。如果数据不重要，或者你在其它层面上能保证数据不会丢失，并且文件有高并发访问得需求，又想最大化利用现有物理存储空间，但是被访问的文件数量非常多的话，建议使用该种模式。
  * **Distributed Replicate**：在该种模式下，一份数据（如一个文件）将会以份为单位存储在 gluster 卷的某一组 brick（Replicate 组）中，且在该组 brick 中没有备份，但在组成该 gluster 卷的每一组 brick 中都有备份。如果数据很重要，又想最大化利用现有物理存储空间，建议使用该种模式。
  * **Striped Replicate**：在该种模式下，一份数据（如一个文件）将会分成碎片存储在 gluster 卷的某一组 brick（Strip 组）中的所有 brick 中，且在该组中没有备份，但在组成该 gluster 卷的每一组 brick 中都有备份。如果数据很重要，并且文件有高并发访问的需求，又想最大化利用现有物理存储空间，建议使用该种模式。

* 设置好 volume **类型**后，点击**添加 Brick**按钮。
* 在弹出的**添加 Brick**设置窗口中，根据你设置的 volume 类型，为 volume 添加 brick。

  * 在**主机**下拉框中，选择一台宿主机。
  * 在 **Brick 目录**文本输入框中，填写 brick 所在的绝对路径（或挂载点的路径）。

    > **注意**
    >
    > 若所填写的路径处于挂载了跟分区的设备中，需要勾选**允许在根分区里出现 brick 并通过清楚 xattrs 重用这些 brick**，生产环境中建议单独为 brick 设置挂载点。

  * brick 的添加顺序在下方的 brick 列表中定义，该顺序在如 **Distributed Strip**、**Distributed Replicate** 类型的 volume 中是作为 Strip 组和 Replicate 组的分组依据，请用**上移**、**下移**按钮调整好 brick 的添加顺序。

  * 点击**确定**按钮，关闭**添加 Brick**设置窗口。

* 勾选**为 Virt 库进行优化**勾选框。
* 点击**确定**。
* 新建立的 gluster 卷会出现在**卷**主标签的列表中，并且处于**停止**状态。
* 在列表中选中新建立的卷，然后点击**启动**按钮。等待卷的所有 brick 都启动起来。
